sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/m/MessageToast","sap/m/MessageBox","sap/ui/core/Icon","sap/m/Link","sap/ui/core/Fragment","sap/m/Dialog","sap/m/Button","sap/m/Text"],function(e,t,o,n,s,i,r,a,l,c){"use strict";return e.extend("com.digitech.digitechproject.controller.form3",{onInit:function(){var e=new sap.ui.model.json.JSONModel({documentfiles:[]});this.getView().setModel(e);this.onReadform();this.onReadAttachments()},onReadform:function(){var e=this;var t=this.getOwnerComponent().getModel();var o=new sap.ui.model.Filter("ID","EQ","c362ec46-8c85-4f2d-9bf2-ca1376945e61");t.read("/supplierReqSrv",{filters:[o],success:function(t){console.log("my form data",t);if(t&&t.results&&t.results.length>0){var o=new sap.ui.model.json.JSONModel(t.results[0]);e.getView().byId("requestFormList").setModel(o);console.log("my form data request submit",o)}else{console.warn("No data found in results.")}},error:function(e){console.error("Error fetching data",e)}})},onReadAttachments:function(){var e=this;var t=this.getOwnerComponent().getModel();var o=new sap.ui.model.Filter("Req_Supplier_ID","EQ","c362ec46-8c85-4f2d-9bf2-ca1376945e61");t.read("/SReqattachmentsSrv",{filters:[o],success:function(t){if(t&&t.results&&t.results.length>0){var o=t.results;var n={pan:o.filter(e=>e.Doc_Type==="PAN"),gst:o.filter(e=>e.Doc_Type==="GST"),cin:o.filter(e=>e.Doc_Type==="CIN")};var s=e.getView().getModel();s.setProperty("/documentFiles",n);console.log("Updated /documentFiles:",s.getProperty("/documentFiles"))}else{console.warn("No data found in results.")}},error:function(e){console.error("Error fetching data",e)}})},formatAttachmentButtonText:function(e,t){e=e||[];return"View Attachments ("+e.length+")"},onOpenDialog:function(e){if(!this._oDialog){this._oDialog=sap.ui.xmlfragment("com.digitech.digitechproject.view.fragment.uploadfile",this);this.getView().addDependent(this._oDialog)}var t=this.getView().getModel();var o=t.getProperty("/documentFiles/"+e)||[];var n=new sap.ui.model.json.JSONModel({documentFiles:o});this._oDialog.setModel(n);this._oDialog.data("documentType",e);this._oDialog.open()},onCloseDialog:function(){if(this._oDialog){this._oDialog.close()}},onDownloadFile:function(e){const t=e.getSource().data("fileName");const n=this._oDialog.data("documentType");var s=this.getView().getModel();var i=s.getProperty("/documentFiles/"+n);var r=i.find(e=>e.fileName===t);console.log("Selected File: ",r);if(r&&r.__metadata&&r.__metadata.media_src){var a=r.__metadata.media_src;fetch(a).then(e=>{if(!e.ok){throw new Error("File format not supported or file unavailable")}return e.blob()}).then(e=>{const o=e.type||"application/octet-stream";const n=document.createElement("a");n.href=URL.createObjectURL(e);n.download=t;n.click()}).catch(e=>{console.error("Error fetching file content: ",e);o.show("Error downloading file: Unsupported format or unavailable.")})}else{o.show("File not found or missing content.")}},onDeleteFile:function(e){const t=e.getSource().data("fileName");const n=this._oDialog.data("documentType");sap.m.MessageBox.confirm(`Are you sure you want to delete the file "${t}"?`,{onClose:function(e){if(e==="OK"){const e=this.getView().getModel();const s=e.getProperty("/documentFiles/"+n);const i=s.filter(e=>e.fileName!==t);e.setProperty("/documentFiles/"+n,i);o.show(`File "${t}" deleted successfully.`);this.onCloseDialog()}}.bind(this)})},_base64ToBlob:function(e){if(e.startsWith("data:")){e=e.split(",")[1]}console.log("Base64 String: ",e);try{const t=atob(e);const o=[];for(let e=0;e<t.length;e+=512){const n=t.slice(e,e+512);const s=new Array(n.length);for(let e=0;e<n.length;e++){s[e]=n.charCodeAt(e)}const i=new Uint8Array(s);o.push(i)}return new Blob(o,{type:"application/octet-stream"})}catch(e){console.error("Base64 decoding failed: ",e);return null}}})});
//# sourceMappingURL=form3.controller.js.map